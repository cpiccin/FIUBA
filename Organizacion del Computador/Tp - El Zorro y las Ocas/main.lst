     1                                  global main
     2                                  
     3                                  extern fopen
     4                                  extern fclose
     5                                  extern fgets 
     6                                  extern printf
     7                                  
     8                                  section .data           
     9 00000000 0000                        ocasCapturadas          dw 0; empieza en 0
    10                                  
    11 00000002 686F6C6100                  prueba                  db "hola",0
    12                                      
    13 00000007 506172746964612066-         msgGanoZorro            db "Partida finalizada. Gano el zorro",10,0
    13 00000010 696E616C697A616461-
    13 00000019 2E2047616E6F20656C-
    13 00000022 207A6F72726F0A00   
    14 0000002A 506172746964612066-         msgGanoOcas             db "Partida finalizada. Ganaron las ocas",10,0
    14 00000033 696E616C697A616461-
    14 0000003C 2E2047616E61726F6E-
    14 00000045 206C6173206F636173-
    14 0000004E 0A00               
    15                                  
    16 00000050 706172746964615F67-         filePartida             db "partida_guardada.txt",0
    16 00000059 756172646164612E74-
    16 00000062 787400             
    17 00000065 7200                        modo                    db "r",0
    18                                  
    19 00000067 257300                      format                  db "%s",0
    20                                  
    21                                  section .bss
    22 00000000 ????????????????            handlePartida           resq 1
    23 00000008 <res 32h>                   tablero                 times 50 resb 1 ; tablero 7x7 + null byte 
    24 0000003A <res 9h>                    estadisticas            times 9 resb 1 ; vector de estadisticas: [arr, abj, izq, der, diagArrIzq, diagArrDer, diagAbjIzq, diagAbjDer]
    25 00000043 ????????                    turnoDe                 resd 1 ; turno actual
    26                                  
    27                                  section .text
    28                                  main: 
    29 00000000 E842000000                  call manejoDeArchivo 
    30                                  
    31                                      ; print estadisticas
    32 00000005 48BF-                       mov rdi, format ; pointer to format string
    32 00000007 [6700000000000000] 
    33 0000000F 48BE-                       mov rsi, estadisticas ; pointer to string to print
    33 00000011 [3A00000000000000] 
    34 00000019 4883EC08                    sub rsp, 8 ; align stack
    35 0000001D E8(00000000)                call printf
    36 00000022 4883C408                    add rsp, 8 ; restore stack
    37                                  
    38                                      ; print turnoDe
    39 00000026 48BF-                       mov rdi, format ; pointer to format string
    39 00000028 [6700000000000000] 
    40 00000030 48BE-                       mov rsi, turnoDe ; pointer to string to print
    40 00000032 [4300000000000000] 
    41 0000003A 4883EC08                    sub rsp, 8 ; align stack
    42 0000003E E8(00000000)                call printf
    43 00000043 4883C408                    add rsp, 8 ; restore stack
    44                                  
    45                                  
    46                                  manejoDeArchivo: 
    47                                      ; abrir archivo
    48 00000047 48BF-                       mov rdi, filePartida
    48 00000049 [5000000000000000] 
    49 00000051 48BE-                       mov rsi, modo 
    49 00000053 [6500000000000000] 
    50 0000005B 4883EC08                    sub rsp, 8
    51 0000005F E8(00000000)                call fopen
    52 00000064 4883C408                    add rsp, 8
    53 00000068 48890425[00000000]          mov [handlePartida], rax 
    54                                  
    55                                      ;leo tablero  
    56 00000070 48BF-                       mov rdi, tablero
    56 00000072 [0800000000000000] 
    57 0000007A BE32000000                  mov rsi, 50
    58 0000007F 488B1425[00000000]          mov rdx, [handlePartida]
    59 00000087 4883EC08                    sub rsp, 8
    60 0000008B E8(00000000)                call fgets 
    61 00000090 4883C408                    add rsp, 8
    62                                      ;leo estadisticas
    63 00000094 48BF-                       mov rdi, estadisticas
    63 00000096 [3A00000000000000] 
    64 0000009E BE09000000                  mov rsi, 9
    65 000000A3 488B1425[00000000]          mov rdx, [handlePartida]
    66 000000AB 4883EC08                    sub rsp, 8
    67 000000AF E8(00000000)                call fgets 
    68 000000B4 4883C408                    add rsp, 8
    69                                      ;leo turnoDe
    70 000000B8 48BF-                       mov rdi, turnoDe
    70 000000BA [4300000000000000] 
    71 000000C2 BE01000000                  mov rsi, 1
    72 000000C7 488B1425[00000000]          mov rdx, [handlePartida]
    73 000000CF 4883EC08                    sub rsp, 8
    74 000000D3 E8(00000000)                call fgets 
    75 000000D8 4883C408                    add rsp, 8
    76                                  
    77 000000DC 488B3C25[00000000]          mov rdi,[handlePartida]
    78 000000E4 4883EC08                    sub rsp, 8
    79 000000E8 E8(00000000)                call fclose 
    80 000000ED 4883C408                    add rsp, 8
    81                                      
    82 000000F1 C3                          ret
