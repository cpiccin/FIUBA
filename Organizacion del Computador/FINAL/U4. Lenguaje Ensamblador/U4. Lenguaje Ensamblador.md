# U4 - Lenguaje Ensamblador

- <ins>**Lenguaje de maquina/Codigo de maquina**</ins>: representacion binaria de un programa de computadora el cual es leido e interpretado por el computador. Consiste en una secuencia de instrucciones de maquina.<br>
- <ins>**Lenguaje ensamblador**</ins>: representacion simbolica del lenguaje de maquina de un procesador especifico. Le agrega una capa de abstraccion al lenguaje de maquina y simplifica su uso.

## Transicion de lenguaje de maquina a ensamblador
![maquina](https://github.com/cpiccin/FIUBA/assets/103950114/ec5039a8-3e1e-431d-8661-86359998d801) <br>

## Elementos que componen a un lenguaje ensamblador
- <ins>Etiquetas:</ins> primera columna
- <ins>Mnemonicos:</ins> segunda columana; representaciones simbolicas del codigo de operacion o directivas
- <ins>Operandos:</ins> tercera columna
- <ins>Comentarios:</ins> posibilidad de comentar para aclarar el codigo
  
## Tipos de sentencias
- <ins>Instrucciones:</ins> se transformaran en instrucciones de maquina para la computadora.
- <ins>Directivas (pseudoinstrucciones):</ins> ejemplo de Intel: `resb` reserva bytes.
- <ins>Macroinstrucciones:</ins> referencia a una secuencia de instrucciones que se puede llamar en el programa. En Intel son las `%macro`.

## Traduccion versus Interpretacion
### Traductor
Programa que convierte un programa de usuario escrito en un lenguaje (fuente) en otro lenguaje (destino).
- <ins>Compiladores:</ins> traduce un lenguaje fuente (ej C) en un lenguaje maquina.
- <ins>Ensambladores:</ins> traduce un lenguaje fuente (que es el lenguaje ensamblador) en el lenguaje destino que es el lenguaje de maquina.
Mismo destino, difieren en el tipo de lenguaje: **Lenguajes ensambladores** [Intel 64, ARM, SPARC, MIPS] o **Lenguajes compilados** [C, C++, Go, Rust] 
### Interprete
Programa que ejecuta directamente un programa de usuario escrito en un lenguaje fuente.
A diferencia de los compiladores, que traducen todo el código fuente a código máquina antes de la ejecución, los intérpretes realizan esta traducción y ejecución paso a paso, instrucción por instrucción.l Lee el programa línea por línea, lo traduce a lenguaje máquina y lo ejecuta sobre la marcha. <br>
- **Lenguajes interpretados** [Python, JavaScript, Ruby] aquel que no necesita ser compilado previamente a su ejecución.
- **Bytecode** [Java] construccion del bytecode, conversion en un codigo binario intermedio que es entendido por la maquina virtual de Java.

## Ensambladores
Programa que traduce un programa escrito en un lenguaje ensamblador y produce un codigo objeto `.o` como salida.<br>
Traduccion 1 a 1 a lenguaje maquina
Hay dos tipos de ensambladores, con una pasada o con dos pasadas, pasada siendo el barrido/lectura sobre el archivo. Particularmente se explica el ensamblador de dos pasadas:

### Primer pasada
La primer pasada es para generar una *tabla de simbolos* (que se puede ver en el *listing de ensamblado*): en cada fila de la tabla estan los simbolos (o etiquetas/rotulos/labels por ejemplo el _start que define el inicio de programa; tambien puede ser los nombres de las areas de memoria que se reservan, entre otros) asociados a una posicion relativa. Permite que el ensamblador reserve espacio adecuado para variables, realice la asignación de direcciones de memoria y calcule las direcciones de salto y acceso de datos en el código final. Se utiliza esta tabla en la segunda pasada para poder hacer la traduccion.<br>
#### Como se genera la tabla de simbolos?
  * Se inicializa un contador, el LC [location counter] en 0 con el 1er byte del codigo objeto que puede ensamblar (por ej va a ignorar un comentario porque no es algo ensamblable). Va a ser lo que defina la posicion relativa de cada simbolo
 * Se examina cada sentencia del lenguaje ensamblador
 * Se determina la longitud de la instruccion de maquina (reconoce `Opcode + modo de direccionamiento + operandos`) para saber cuantos bytes se tiene que mover el LC. Para ARM donde el tamaño es fijo (32 bits), es un paso trivial pero sino lo tiene que calcular.
 * Revisa directivas al ensamblador, por ejemplo reserva de areas de memoria.
 * Por cada etiqueta encontrada se fija si está en la tabla de símbolos. Si no lo está, la agrega (si es la definición, registra el LC como tal, si no, lo registra como referenciando a la etiqueta). 

### Segunda pasada (Traduccion)
Aca se convierte efectivamente el codigo fuente en codigo maquina, generando el codigo objeto.
- Traduce el mnemonico (operacion) en el opcode binario que lo representa.
- Usa el opcode para determinar el formato de la instruccion, la posicion y el tamaño de cada uno de los campos de la instruccion.
Una vez que se conoce el formato de la instruccion se leen el resto de campos de la instruccion y se realiza la traduccion. 
- Si encuentra un registro o codigo de memoria, traduce cada operando a su codigo binario correspondiente.
- Si encuentra un inmediato, traduce cada valor inmediato en un string binario en la instruccion.
- Si encuentra referencias a etiquetas, traduce las referencias a etiquetas en el valor apropiado de LC usando la tabla de simbolos.
- Puede ser que la instruccion tenga otro tipo de informacion necesaria, entonces setea esos bits (que pueden corresponder por ej. a indicadores de modo de direccionamiento, bits de codigo de condicion, etc).
